<!DOCTYPE html>
<!--
    QR Code Generator
    Version: 0.6
    Date: 2nd October 2025
    
    Description: A web-based QR code generator that creates QR codes in PNG or SVG format
    with support for multiple content types (URLs, text, email, phone, SMS, WiFi, vCard, events),
    custom colours, and logo overlays with automatic error correction.
    
    Created by: Your Name & Claude Sonnet 4.5 (Anthropic)
    Repository: https://github.com/davidianwalker1207/qr-generator
    
    Licence: MIT License
    Copyright (c) 2025 [Your Name]
    
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicence, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:
    
    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.
    
    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.
    
    Usage Note: This project is free to use, modify, and incorporate into your own
    projects (personal or commercial). However, please don't just repackage and sell
    it as-is. If you're going to sell something based on this, add your own value.
    
    Features:
    - Multiple QR code categories (URL, text, email, phone, SMS, WiFi, vCard, calendar events)
    - PNG and SVG output formats
    - Custom dot and background colours
    - Logo upload with automatic high error correction
    - Input preservation when switching categories
    - Client-side generation (no server required)
    
    Libraries used:
    - qrcode-generator v1.4.4 (https://github.com/kazuhikoarase/qrcode-generator)
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #0C2347;
            min-height: 100vh;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            position: relative;
        }
        
        h1 {
            text-align: center;
            color: #0C2347;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        input[type="text"], input[type="email"], input[type="tel"], input[type="url"], 
        input[type="password"], input[type="datetime-local"], input[type="file"],
        input[type="color"], input[type="number"],
        textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        
        input[type="color"] {
            height: 45px;
            padding: 5px;
            cursor: pointer;
        }
        
        input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus,
        input[type="url"]:focus, input[type="password"]:focus, input[type="datetime-local"]:focus,
        input[type="number"]:focus, textarea:focus, select:focus {
            border-color: #0C2347;
            outline: none;
            box-shadow: 0 0 0 3px rgba(12, 35, 71, 0.1);
        }
        
        button {
            background: #0C2347;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            width: 100%;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(12, 35, 71, 0.3);
        }
        
        #qrcode {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 0px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .qr-placeholder {
            color: #999;
            font-style: italic;
        }
        
        #downloadBtn {
            margin-top: 15px;
            display: none;
        }
        
        #helpBtn {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }
        
        #helpBtn svg {
            width: 20px;
            height: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            line-height: 20px;
        }
        
        .close-modal:hover {
            color: #0C2347;
        }
        
        .modal h2 {
            color: #0C2347;
            margin-top: 0;
            margin-bottom: 20px;
        }
        
        .modal h3 {
            color: #0C2347;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        
        .modal ol, .modal ul {
            line-height: 1.8;
            color: #555;
        }
        
        .modal li {
            margin-bottom: 8px;
        }
        
        .wifi-security {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .security-option {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-row .input-group {
            margin-bottom: 0;
        }
        
        #logoPreview {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QR Code Generator</h1>
        
        <button id="helpBtn" onclick="openHelpModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            How to Use
        </button>
        
        <div class="input-group">
            <label for="categorySelect">QR Code Category:</label>
            <select id="categorySelect" onchange="changeCategory()">
                <option value="url" selected>Website URL</option>
                <option value="text">Text/Custom</option>
                <option value="email">Email</option>
                <option value="phone">Phone Number</option>
                <option value="sms">SMS Text</option>
                <option value="wifi">WiFi Network</option>
                <option value="vcard">Contact Card</option>
                <option value="event">Calendar Event</option>
            </select>
        </div>

        <div id="inputFields"></div>
        
        <div class="input-group">
            <label for="formatSelect">Output Format:</label>
            <select id="formatSelect">
                <option value="png" selected>PNG (Raster Image)</option>
                <option value="svg">SVG (Vector - Scalable)</option>
            </select>
        </div>
        
        <div class="input-group">
            <label>QR Code Colours:</label>
            <div class="form-row">
                <div class="input-group">
                    <label for="dotColor">Dot Colour:</label>
                    <input type="color" id="dotColor" value="#000000" />
                </div>
                <div class="input-group">
                    <label for="bgColor">Background Colour:</label>
                    <input type="color" id="bgColor" value="#ffffff" />
                </div>
            </div>
        </div>
        
        <div class="input-group">
            <label for="logoUpload">Upload Logo Image (optional):</label>
            <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)" />
            <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                Logo will be placed in the centre (recommended: square images, max 30% of QR size)
            </small>
            <div id="logoPreview" style="margin-top: 10px; display: none;">
                <img id="logoPreviewImg" style="max-width: 100px; max-height: 100px; border-radius: 5px; border: 2px solid #e1e5e9;" />
                <button type="button" onclick="clearLogo()" style="padding: 5px 10px; font-size: 14px; background: #dc3545;">Remove Logo</button>
            </div>
        </div>
        
        <button onclick="generateQR()">Generate QR Code</button>
        
        <div id="qrcode">
            <div class="qr-placeholder">Your QR code will appear here</div>
        </div>
        
        <button id="downloadBtn" onclick="downloadQR()">Download QR Code</button>
        
        <div style="margin-top: 30px; text-align: center; padding-top: 20px; border-top: 1px solid #e1e5e9;">
            <p style="color: #666; font-size: 14px; margin: 5px 0;">
                Need help or found an issue? 
                <a href="https://github.com/davidianwalker1207/qr-generator" target="_blank" style="color: #0C2347; text-decoration: none; font-weight: 600;">Visit the GitHub repository</a>
            </p>
            <p style="color: #999; font-size: 12px; margin: 5px 0;">
                Version 0.6 • MIT Licence • Free to use and modify
            </p>
            <p style="color: #666; font-size: 13px; margin: 15px 0 5px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; line-height: 1.6;">
                <strong style="color: #0C2347;">Accessibility Commitment:</strong> I am committed to making all my work accessible and WCAG compliant. 
                If you encounter any accessibility issues whilst using this tool, please 
                <a href="https://github.com/davidianwalker1207/qr-generator/issues" target="_blank" style="color: #0C2347; text-decoration: underline;">report them on GitHub</a> 
                so they can be fixed promptly.
            </p>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div id="helpModal" class="modal" onclick="closeHelpModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-modal" onclick="closeHelpModal()">&times;</span>
            <h2>How to Use the QR Code Generator</h2>
            
            <h3>Quick Start</h3>
            <ol>
                <li>Select your QR code category from the dropdown menu</li>
                <li>Fill in the required information</li>
                <li>Click "Generate QR Code"</li>
                <li>Click "Download QR Code" to save your file</li>
            </ol>
            
            <h3>QR Code Categories</h3>
            <ul>
                <li><strong>Website URL:</strong> Create QR codes that open websites</li>
                <li><strong>Text/Custom:</strong> Encode any text or data</li>
                <li><strong>Email:</strong> Generate mailto links with optional subject and message</li>
                <li><strong>Phone Number:</strong> Create clickable phone numbers</li>
                <li><strong>SMS Text:</strong> Pre-fill SMS messages</li>
                <li><strong>WiFi Network:</strong> Share WiFi credentials easily</li>
                <li><strong>Contact Card:</strong> Create vCard contact information</li>
                <li><strong>Calendar Event:</strong> Generate iCalendar events</li>
            </ul>
            
            <h3>Customisation Options</h3>
            <ul>
                <li><strong>Output Format:</strong> Choose PNG (standard image) or SVG (scalable vector)</li>
                <li><strong>Colours:</strong> Customise both the QR code dots and background</li>
                <li><strong>Logo Upload:</strong> Add your logo to the centre of the QR code (automatically uses high error correction to maintain scannability)</li>
            </ul>
            
            <h3>Tips</h3>
            <ul>
                <li>For logos, use square images for best results</li>
                <li>Keep logos under 30% of the QR code size</li>
                <li>Test your QR codes before printing to ensure they scan properly</li>
                <li>Use high contrast colours for better scanning reliability</li>
                <li>SVG format is best for printing or scaling to large sizes</li>
                <li>Your data never leaves your browser - everything is processed locally</li>
            </ul>
            
            <p style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e1e5e9; color: #666;">
                For more help or to report issues, visit the 
                <a href="https://github.com/davidianwalker1207/qr-generator" target="_blank" style="color: #0C2347;">GitHub repository</a>.
            </p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
    <script>
        let currentQRData = null;
        let uploadedLogo = null;
        let savedInputs = {};
        
        const inputTemplates = {
            url: `
                <div class="input-group">
                    <label for="urlInput">Website URL:</label>
                    <input type="text" id="urlInput" placeholder="https://example.com" />
                </div>
            `,
            text: `
                <div class="input-group">
                    <label for="textInput">Enter text:</label>
                    <textarea id="textInput" rows="3" placeholder="Enter any text or data you want to encode..."></textarea>
                </div>
            `,
            email: `
                <div class="form-row">
                    <div class="input-group">
                        <label for="emailInput">Email Address:</label>
                        <input type="email" id="emailInput" placeholder="name@example.com" />
                    </div>
                    <div class="input-group">
                        <label for="emailSubject">Subject (optional):</label>
                        <input type="text" id="emailSubject" placeholder="Email subject" />
                    </div>
                </div>
                <div class="input-group">
                    <label for="emailBody">Message (optional):</label>
                    <textarea id="emailBody" rows="3" placeholder="Email message body..."></textarea>
                </div>
            `,
            phone: `
                <div class="input-group">
                    <label for="phoneInput">Phone Number:</label>
                    <input type="tel" id="phoneInput" placeholder="+1234567890" />
                </div>
            `,
            sms: `
                <div class="form-row">
                    <div class="input-group">
                        <label for="smsPhone">Phone Number:</label>
                        <input type="tel" id="smsPhone" placeholder="+1234567890" />
                    </div>
                    <div class="input-group">
                        <label for="smsMessage">Message:</label>
                        <textarea id="smsMessage" rows="2" placeholder="SMS message..."></textarea>
                    </div>
                </div>
            `,
            wifi: `
                <div class="form-row">
                    <div class="input-group">
                        <label for="wifiSSID">Network Name (SSID):</label>
                        <input type="text" id="wifiSSID" placeholder="MyWiFiNetwork" />
                    </div>
                    <div class="input-group">
                        <label for="wifiPassword">Password:</label>
                        <input type="password" id="wifiPassword" placeholder="WiFi password" />
                    </div>
                </div>
                <div class="input-group">
                    <label>Security Type:</label>
                    <div class="wifi-security">
                        <div class="security-option">
                            <input type="radio" id="wpa" name="security" value="WPA" checked />
                            <label for="wpa">WPA/WPA2</label>
                        </div>
                        <div class="security-option">
                            <input type="radio" id="wep" name="security" value="WEP" />
                            <label for="wep">WEP</label>
                        </div>
                        <div class="security-option">
                            <input type="radio" id="nopass" name="security" value="nopass" />
                            <label for="nopass">No Password</label>
                        </div>
                    </div>
                </div>
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="wifiHidden" /> Network is hidden
                    </label>
                </div>
            `,
            vcard: `
                <div class="form-row">
                    <div class="input-group">
                        <label for="vcardFirstName">First Name:</label>
                        <input type="text" id="vcardFirstName" placeholder="John" />
                    </div>
                    <div class="input-group">
                        <label for="vcardLastName">Last Name:</label>
                        <input type="text" id="vcardLastName" placeholder="Doe" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label for="vcardPhone">Phone:</label>
                        <input type="tel" id="vcardPhone" placeholder="+1234567890" />
                    </div>
                    <div class="input-group">
                        <label for="vcardEmail">Email:</label>
                        <input type="email" id="vcardEmail" placeholder="john@example.com" />
                    </div>
                </div>
                <div class="input-group">
                    <label for="vcardOrg">Organisation (optional):</label>
                    <input type="text" id="vcardOrg" placeholder="Company Name" />
                </div>
                <div class="input-group">
                    <label for="vcardUrl">Website (optional):</label>
                    <input type="url" id="vcardUrl" placeholder="https://example.com" />
                </div>
            `,
            event: `
                <div class="form-row">
                    <div class="input-group">
                        <label for="eventTitle">Event Title:</label>
                        <input type="text" id="eventTitle" placeholder="Meeting Title" />
                    </div>
                    <div class="input-group">
                        <label for="eventLocation">Location (optional):</label>
                        <input type="text" id="eventLocation" placeholder="Conference Room A" />
                    </div>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label for="eventStartDate">Start Date:</label>
                        <input type="datetime-local" id="eventStartDate" />
                    </div>
                    <div class="input-group">
                        <label for="eventEndDate">End Date:</label>
                        <input type="datetime-local" id="eventEndDate" />
                    </div>
                </div>
                <div class="input-group">
                    <label for="eventDescription">Description (optional):</label>
                    <textarea id="eventDescription" rows="3" placeholder="Event description..."></textarea>
                </div>
            `
        };
        
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedLogo = e.target.result;
                document.getElementById('logoPreviewImg').src = uploadedLogo;
                document.getElementById('logoPreview').style.display = 'flex';
            };
            reader.readAsDataURL(file);
        }
        
        function clearLogo() {
            uploadedLogo = null;
            document.getElementById('logoUpload').value = '';
            document.getElementById('logoPreview').style.display = 'none';
        }
        
        function saveCurrentInputs(category) {
            const inputs = document.getElementById('inputFields').querySelectorAll('input, textarea, select');
            savedInputs[category] = {};
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (input.checked) {
                        savedInputs[category][input.name] = input.value;
                    }
                } else if (input.type === 'checkbox') {
                    savedInputs[category][input.id] = input.checked;
                } else {
                    savedInputs[category][input.id] = input.value;
                }
            });
        }
        
        function restoreInputs(category) {
            if (!savedInputs[category]) return;
            
            setTimeout(() => {
                Object.keys(savedInputs[category]).forEach(key => {
                    const element = document.getElementById(key) || document.querySelector(`input[name="${key}"]`);
                    if (element) {
                        if (element.type === 'radio') {
                            if (element.value === savedInputs[category][key]) {
                                element.checked = true;
                            }
                        } else if (element.type === 'checkbox') {
                            element.checked = savedInputs[category][key];
                        } else {
                            element.value = savedInputs[category][key];
                        }
                    }
                });
            }, 10);
        }
        
        function changeCategory() {
            const previousCategory = document.getElementById('inputFields').dataset.currentCategory;
            if (previousCategory) {
                saveCurrentInputs(previousCategory);
            }
            
            const category = document.getElementById('categorySelect').value;
            const inputFields = document.getElementById('inputFields');
            inputFields.innerHTML = inputTemplates[category];
            inputFields.dataset.currentCategory = category;
            
            restoreInputs(category);
            document.getElementById('downloadBtn').style.display = 'none';
        }
        
        function getQRData() {
            const category = document.getElementById('categorySelect').value;
            let data = '';
            
            switch (category) {
                case 'text':
                    data = document.getElementById('textInput').value;
                    break;
                case 'url':
                    data = document.getElementById('urlInput').value;
                    if (data && !data.startsWith('http')) {
                        data = 'https://' + data;
                    }
                    break;
                case 'email':
                    const emailAddr = document.getElementById('emailInput').value;
                    const emailSubj = document.getElementById('emailSubject').value;
                    const emailBody = document.getElementById('emailBody').value;
                    data = `mailto:${emailAddr}`;
                    if (emailSubj || emailBody) {
                        data += '?';
                        if (emailSubj) data += `subject=${encodeURIComponent(emailSubj)}`;
                        if (emailSubj && emailBody) data += '&';
                        if (emailBody) data += `body=${encodeURIComponent(emailBody)}`;
                    }
                    break;
                case 'phone':
                    data = `tel:${document.getElementById('phoneInput').value}`;
                    break;
                case 'sms':
                    const smsPhone = document.getElementById('smsPhone').value;
                    const smsMsg = document.getElementById('smsMessage').value;
                    data = `sms:${smsPhone}`;
                    if (smsMsg) data += `?body=${encodeURIComponent(smsMsg)}`;
                    break;
                case 'wifi':
                    const wifiSSID = document.getElementById('wifiSSID').value;
                    const wifiPass = document.getElementById('wifiPassword').value;
                    const wifiSec = document.querySelector('input[name="security"]:checked').value;
                    const wifiHidden = document.getElementById('wifiHidden').checked;
                    data = `WIFI:T:${wifiSec};S:${wifiSSID};P:${wifiPass};H:${wifiHidden ? 'true' : 'false'};;`;
                    break;
                case 'vcard':
                    const vcardFirst = document.getElementById('vcardFirstName').value;
                    const vcardLast = document.getElementById('vcardLastName').value;
                    const vcardPhone = document.getElementById('vcardPhone').value;
                    const vcardEmail = document.getElementById('vcardEmail').value;
                    const vcardOrg = document.getElementById('vcardOrg').value;
                    const vcardUrl = document.getElementById('vcardUrl').value;
                    data = `BEGIN:VCARD\nVERSION:3.0\nFN:${vcardFirst} ${vcardLast}\n`;
                    if (vcardPhone) data += `TEL:${vcardPhone}\n`;
                    if (vcardEmail) data += `EMAIL:${vcardEmail}\n`;
                    if (vcardOrg) data += `ORG:${vcardOrg}\n`;
                    if (vcardUrl) data += `URL:${vcardUrl}\n`;
                    data += 'END:VCARD';
                    break;
                case 'event':
                    const eventTitle = document.getElementById('eventTitle').value;
                    const eventLoc = document.getElementById('eventLocation').value;
                    const eventStart = document.getElementById('eventStartDate').value;
                    const eventEnd = document.getElementById('eventEndDate').value;
                    const eventDesc = document.getElementById('eventDescription').value;
                    
                    const formatDate = (dateStr) => {
                        if (!dateStr) return '';
                        return new Date(dateStr).toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
                    };
                    
                    data = `BEGIN:VEVENT\nSUMMARY:${eventTitle}\n`;
                    if (eventLoc) data += `LOCATION:${eventLoc}\n`;
                    if (eventStart) data += `DTSTART:${formatDate(eventStart)}\n`;
                    if (eventEnd) data += `DTEND:${formatDate(eventEnd)}\n`;
                    if (eventDesc) data += `DESCRIPTION:${eventDesc}\n`;
                    data += 'END:VEVENT';
                    break;
            }
            
            return data;
        }
        
        function getErrorCorrectionLevel() {
            return uploadedLogo ? 'H' : 'M';
        }
        
        function generateQR() {
            const data = getQRData();
            const format = document.getElementById('formatSelect').value;
            const errorCorrection = getErrorCorrectionLevel();
            
            const dotColor = document.getElementById('dotColor').value;
            const bgColor = document.getElementById('bgColor').value;
            
            if (!data.trim()) {
                alert('Please fill in the required fields to generate QR code');
                return;
            }
            
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '<div style="color: #666;">Generating QR code...</div>';
            
            try {
                const typeNumber = 0;
                const qr = qrcode(typeNumber, errorCorrection);
                qr.addData(data);
                qr.make();
                
                if (format === 'svg') {
                    generateSVG(qr, dotColor, bgColor, qrContainer, data);
                } else {
                    generatePNG(qr, dotColor, bgColor, qrContainer, data);
                }
                
                document.getElementById('downloadBtn').style.display = 'inline-block';
                
            } catch (error) {
                console.error('QR generation error:', error);
                qrContainer.innerHTML = '<div style="color: #dc3545;">Error generating QR code. Please try again.</div>';
            }
        }
        
        function generateSVG(qr, dotColor, bgColor, container, data) {
            const moduleCount = qr.getModuleCount();
            const cellSize = 4;
            const margin = 4;
            const size = (moduleCount + margin * 2) * cellSize;
            
            let svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}">`;
            svg += `<rect width="${size}" height="${size}" fill="${bgColor}"/>`;
            
            for (let row = 0; row < moduleCount; row++) {
                for (let col = 0; col < moduleCount; col++) {
                    if (qr.isDark(row, col)) {
                        const x = (col + margin) * cellSize;
                        const y = (row + margin) * cellSize;
                        svg += `<rect x="${x}" y="${y}" width="${cellSize}" height="${cellSize}" fill="${dotColor}"/>`;
                    }
                }
            }
            
            if (uploadedLogo) {
                const logoSize = moduleCount * cellSize * 0.25;
                const logoX = (size - logoSize) / 2;
                const logoY = (size - logoSize) / 2;
                const bgSize = logoSize + 12;
                const bgX = (size - bgSize) / 2;
                const bgY = (size - bgSize) / 2;
                
                svg += `<rect x="${bgX}" y="${bgY}" width="${bgSize}" height="${bgSize}" fill="#ffffff"/>`;
                svg += `<image x="${logoX}" y="${logoY}" width="${logoSize}" height="${logoSize}" href="${uploadedLogo}"/>`;
            }
            
            svg += '</svg>';
            
            const blob = new Blob([svg], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            
            container.innerHTML = `
                <div>
                    <img src="${url}" alt="QR Code" style="max-width: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
                    <p style="margin-top: 15px; color: #666; font-size: 14px;">SVG QR Code for: ${data.length > 50 ? data.substring(0, 50) + '...' : data}</p>
                </div>
            `;
            
            currentQRData = { url: url, text: data, format: 'svg', svgContent: svg };
        }
        
        function generatePNG(qr, dotColor, bgColor, container, data) {
            const moduleCount = qr.getModuleCount();
            const cellSize = 8;
            const margin = 4;
            const size = (moduleCount + margin * 2) * cellSize;
            
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, size, size);
            
            ctx.fillStyle = dotColor;
            for (let row = 0; row < moduleCount; row++) {
                for (let col = 0; col < moduleCount; col++) {
                    if (qr.isDark(row, col)) {
                        const x = (col + margin) * cellSize;
                        const y = (row + margin) * cellSize;
                        ctx.fillRect(x, y, cellSize, cellSize);
                    }
                }
            }
            
            if (uploadedLogo) {
                const logoSize = Math.floor(moduleCount * cellSize * 0.25);
                const bgSize = logoSize + 12;
                const centerX = size / 2;
                const centerY = size / 2;
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(centerX - bgSize / 2, centerY - bgSize / 2, bgSize, bgSize);
                
                const logoImg = new Image();
                logoImg.onload = function() {
                    ctx.drawImage(logoImg, centerX - logoSize / 2, centerY - logoSize / 2, logoSize, logoSize);
                    displayPNGResult(canvas, container, data);
                };
                logoImg.src = uploadedLogo;
            } else {
                displayPNGResult(canvas, container, data);
            }
        }
        
        function displayPNGResult(canvas, container, data) {
            const dataUrl = canvas.toDataURL('image/png');
            
            container.innerHTML = `
                <div>
                    <img src="${dataUrl}" alt="QR Code" style="max-width: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
                    <p style="margin-top: 15px; color: #666; font-size: 14px;">PNG QR Code for: ${data.length > 50 ? data.substring(0, 50) + '...' : data}</p>
                </div>
            `;
            
            currentQRData = { url: dataUrl, text: data, format: 'png' };
        }
        
        function downloadQR() {
            if (!currentQRData) return;
            
            const link = document.createElement('a');
            
            if (currentQRData.format === 'svg') {
                const blob = new Blob([currentQRData.svgContent], { type: 'image/svg+xml' });
                link.href = URL.createObjectURL(blob);
                link.download = `qr-code-${Date.now()}.svg`;
            } else {
                link.href = currentQRData.url;
                link.download = `qr-code-${Date.now()}.png`;
            }
            
            link.click();
        }
        
        function openHelpModal() {
            document.getElementById('helpModal').style.display = 'block';
        }
        
        function closeHelpModal(event) {
            if (!event || event.target === document.getElementById('helpModal')) {
                document.getElementById('helpModal').style.display = 'none';
            }
        }
        
        window.addEventListener('load', function() {
            changeCategory();
        });
        
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                generateQR();
            }
        });
    </script>
</body>
</html>